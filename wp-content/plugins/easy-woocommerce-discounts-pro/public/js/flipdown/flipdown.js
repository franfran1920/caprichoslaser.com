"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var FlipDown=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"flipdown",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,n),"object"===_typeof(e)&&(i=e,e="flipdown"),this.version="0.2.2",this.time=t,this.initialised=!1,this.daysLabel=i.daysLabel||"Days",this.hoursLabel=i.hoursLabel||"Hours",this.minutesLabel=i.minutesLabel||"Minutes",this.secondsLabel=i.secondsLabel||"Seconds",this.headingPosition=i.headingPosition||"top",this.element=document.getElementById(e),this.opts=this._parseOptions(i),this.element.classList.add("flipdown"),this._setOptions()}return _createClass(n,[{key:"start",value:function(){return this.initialised||this._init(),this.countdown=setInterval(this._tick.bind(this),1e3),this}},{key:"stop",value:function(){return this.countdown&&(clearInterval(this.countdown),this.initialised=!1),this}},{key:"ifEnded",value:function(t){return this.hasEndedCallback=function(){t(),this.hasEndedCallback=null},this}},{key:"updateTime",value:function(t){return this.stop(),this.element.innerHTML="",this.time=t,this.start(),this}},{key:"_setTime",value:function(t){if(this.epoch=t,this.remainingTime=!1,"object"==typeof t){if("number"!=typeof t.value)throw new Error("FlipDown: Constructor expected unix timestamp, got ".concat(_typeof(t.value)," instead."));"remainingTime"===t.type?this.remainingTime=t.value:this.epoch=t.value}else if("number"!=typeof t)throw new Error("FlipDown: Constructor expected unix timestamp, got ".concat(_typeof(t)," instead."))}},{key:"_getTime",value:function(){return(new Date).getTime()/1e3}},{key:"_hasCountdownEnded",value:function(){if(!1!==this.remainingTime){if(this.remainingTime<0)return this.countdownEnded=!0,null!=this.hasEndedCallback&&(this.hasEndedCallback(),this.hasEndedCallback=null),!0}else if(this.epoch-this.now<0)return this.countdownEnded=!0,null!=this.hasEndedCallback&&(this.hasEndedCallback(),this.hasEndedCallback=null),!0;return this.countdownEnded=!1}},{key:"_parseOptions",value:function(t){return{theme:t.hasOwnProperty("theme")?t.theme:"dark"}}},{key:"_setOptions",value:function(){this.element.classList.add("flipdown__theme-".concat(this.opts.theme))}},{key:"_init",value:function(){this.initialised=!0,this._setTime(this.time),this.rotors=[],this.rotorLeafFront=[],this.rotorLeafRear=[],this.rotorTops=[],this.rotorBottoms=[],this.countdown=null,this.daysRemaining=0,this.clockValues={},this.clockStrings={},this.clockValuesAsString=[],this.prevClockValuesAsString=[],this.now=this._getTime(),this.countdownEnded=!1,this.hasEndedCallback=null,this._hasCountdownEnded()?this.daysremaining=0:this.daysremaining=Math.floor((!1!==this.remainingTime?this.remainingTime:this.epoch-this.now)/86400).toString().length;for(var t=this.daysremaining<=2?2:this.daysremaining,e=0;e<t+6;e++)this.rotors.push(this._createRotor(0));for(var i=[],e=0;e<t;e++)i.push(this.rotors[e]);this.element.appendChild(this._createRotorGroup(i,this.daysLabel));for(var n=t,s=this.hoursLabel,e=0;e<3;e++){for(var o=[],r=0;r<2;r++)o.push(this.rotors[n]),n++;1===e?s=this.minutesLabel:2===e&&(s=this.secondsLabel),this.element.appendChild(this._createRotorGroup(o,s))}return this.rotorLeafFront=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-front")),this.rotorLeafRear=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-rear")),this.rotorTop=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-top")),this.rotorBottom=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-bottom")),this._tick(),this._updateClockValues(!0),this}},{key:"_createRotorGroup",value:function(t,e){var i=document.createElement("div");i.className="rotor-group";var n=document.createElement("div");return n.className="rotor-group-heading",e&&(n.innerHTML=e),"top"===this.headingPosition&&i.appendChild(n),appendChildren(i,t),"top"!==this.headingPosition&&i.appendChild(n),i}},{key:"_createRotor",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=document.createElement("div"),i=document.createElement("div"),n=document.createElement("figure"),s=document.createElement("figure"),o=document.createElement("div"),r=document.createElement("div");return e.className="rotor",i.className="rotor-leaf",n.className="rotor-leaf-rear",s.className="rotor-leaf-front",o.className="rotor-top",r.className="rotor-bottom",n.textContent=t,o.textContent=t,r.textContent=t,appendChildren(e,[i,o,r]),appendChildren(i,[n,s]),e}},{key:"_tick",value:function(){var t;this.now=this._getTime(),!1===this.remainingTime?t=this.epoch-this.now<=0?0:this.epoch-this.now:(t=!1!==this.remainingTime&&this.remainingTime-1<=0?0:this.remainingTime-1,this.remainingTime=t),this.clockValues.d=Math.floor(t/86400),t-=86400*this.clockValues.d,this.clockValues.h=Math.floor(t/3600),t-=3600*this.clockValues.h,this.clockValues.m=Math.floor(t/60),t-=60*this.clockValues.m,this.clockValues.s=Math.floor(t),this._updateClockValues(),this._hasCountdownEnded()}},{key:"_updateClockValues",value:function(){var i=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];function e(){var i=this;this.rotorTop.forEach(function(t,e){t.textContent!=i.clockValuesAsString[e]&&(t.textContent=i.clockValuesAsString[e])})}function n(){var n=this;this.rotorLeafRear.forEach(function(t,e){var i;t.textContent!=n.clockValuesAsString[e]&&(t.textContent=n.clockValuesAsString[e],t.parentElement.classList.add("flipped"),i=setInterval(function(){t.parentElement.classList.remove("flipped"),clearInterval(i)}.bind(n),500))})}this.clockStrings.d=pad(this.clockValues.d,2),this.clockStrings.h=pad(this.clockValues.h,2),this.clockStrings.m=pad(this.clockValues.m,2),this.clockStrings.s=pad(this.clockValues.s,2),this.clockValuesAsString=(this.clockStrings.d+this.clockStrings.h+this.clockStrings.m+this.clockStrings.s).split(""),this.rotorLeafFront.forEach(function(t,e){t.textContent=i.prevClockValuesAsString[e]}),this.rotorBottom.forEach(function(t,e){t.textContent=i.prevClockValuesAsString[e]}),t?(e.call(this),n.call(this)):(setTimeout(e.bind(this),500),setTimeout(n.bind(this),500)),this.prevClockValuesAsString=this.clockValuesAsString}}]),n}();function pad(t,e){return(t=t.toString()).length<e?pad("0"+t,e):t}function appendChildren(e,t){t.forEach(function(t){e.appendChild(t)})}